<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>System Console</title>
  <style>
    :root { --bg:#0f172a; --panel:#111827; --muted:#94a3b8; --text:#e5e7eb; --border:#273549; --accent:#2dd4bf; }
    html, body { height:100%; margin:0; }
    body { background: var(--bg); color: var(--text); font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial; }
    .wrap { height:100%; display:grid; place-items:center; }
    .card { width: 360px; max-width: calc(100% - 32px); background: linear-gradient(180deg, var(--panel), #0b1220); border:1px solid var(--border); border-radius: 14px; padding: 18px; box-shadow: 0 10px 30px rgba(0,0,0,.35); }
    .brand { font-weight:700; font-size:16px; color:#cbd5e1; margin-bottom: 10px; opacity:.85; }
    label { display:block; font-size:12px; color: var(--muted); margin: 10px 0 6px; }
    input { width:100%; box-sizing:border-box; border:1px solid var(--border); background:#0b1220; color:var(--text); border-radius:10px; padding:10px 12px; }
    .row { display:flex; gap:8px; align-items:center; }
    .btn { width:100%; border:1px solid var(--border); background:#0e1526; color:var(--text); border-radius:10px; padding:10px 14px; font-weight:600; cursor:pointer; }
    .btn:hover { border-color: var(--accent); }
    .status { min-height: 18px; font-size:12px; color: var(--muted); margin-top: 8px; }
    .good { color:#22c55e; }
    .bad { color:#ef4444; }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card" role="form" aria-labelledby="t">
      <div id="t" class="brand">System Console</div>
      <label for="email">Email</label>
      <input id="email" type="email" autocomplete="username" />
      <label for="pw">Password</label>
      <input id="pw" type="password" autocomplete="current-password" />
      <div class="row" style="margin-top:12px;">
        <button id="go" class="btn">Sign in</button>
      </div>
      <div id="st" class="status">&nbsp;</div>
    </div>
  </div>
  <script>
    const email = document.getElementById('email');
    const pw = document.getElementById('pw');
    const st = document.getElementById('st');
    const go = document.getElementById('go');

    async function adminLogin(username, password) {
      const res = await fetch('/auth/admin/login', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ username, password })
      });
      const data = await res.json().catch(()=>({}));
      if (!res.ok) throw new Error(data?.detail || 'Login failed');
      if (!data?.admin_access_token || !data?.access_token) throw new Error('Invalid response');
      // Store tokens for the admin UI to reuse
      sessionStorage.setItem('user_token', data.access_token);
      sessionStorage.setItem('admin_token', data.admin_access_token);
    }

    go.addEventListener('click', async () => {
      const u = (email.value || '').trim();
      const p = pw.value || '';
      if (!u || !p) { st.textContent = 'Email and password are required.'; st.className = 'status bad'; return; }
      st.textContent = 'Signing inâ€¦'; st.className = 'status';
      try {
        await adminLogin(u, p);
        st.textContent = 'OK'; st.className = 'status good';
        location.href = '/admin/ui';
      } catch (e) {
        st.textContent = e.message || String(e);
        st.className = 'status bad';
      }
    });

    // Enter to submit
    [email, pw].forEach(el => el.addEventListener('keydown', (ev) => { if (ev.key === 'Enter') go.click(); }));
  </script>
</body>
</html>
