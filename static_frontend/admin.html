<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Places in Time — Admin Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="icon" href="/static/pit-favicon-mark.ico" />
  <link rel="stylesheet" href="/static/style.css?v=brand-9" />
  <style>
    :root {
      --bg: #0f172a;
      --panel: #111827;
      --muted: #94a3b8;
      --text: #e5e7eb;
      --accent: #60a5fa;
      --accent-2: #34d399;
      --danger: #ef4444;
      --panel-2: #1f2937;
      --border: #273549;
    }
    body {
      background: linear-gradient(180deg, #0b1220, #0f172a 30%, #0b0f1a);
      color: var(--text);
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
      min-height: 100vh;
    }
    .container { max-width: 1100px; margin: 40px auto; padding: 0 16px; }
    .card {
      background: linear-gradient(180deg, var(--panel), var(--panel-2));
      border: 1px solid var(--border);
      border-radius: 16px;
      box-shadow: 0 8px 24px rgba(0,0,0,.35);
      overflow: hidden;
    }
    .header {
      display: flex; align-items: center; justify-content: space-between;
      padding: 18px 20px; border-bottom: 1px solid var(--border);
      background: rgba(255,255,255,0.02); backdrop-filter: blur(6px);
    }
    .title { font-size: 20px; font-weight: 700; }
    .subtitle { color: var(--muted); font-size: 13px; margin-top: 4px; }
    .controls { display: flex; gap: 10px; align-items: center; }
    .pill {
      padding: 6px 10px; border: 1px solid var(--border); border-radius: 999px;
      font-size: 12px; color: var(--muted);
    }
    .pill.good { color: var(--accent-2); border-color: #14532d; background: rgba(20,83,45,.2); }
    .pill.bad { color: var(--danger); border-color: #7f1d1d; background: rgba(127,29,29,.2); }
    .btn {
      border: 1px solid var(--border); color: var(--text); background: #0e1526;
      border-radius: 10px; padding: 10px 14px; font-weight: 600; cursor: pointer;
    }
    .btn:hover { border-color: var(--accent); }
    .btn.primary { background: linear-gradient(180deg, #1a2376, #1e40af); }
    .btn.success { background: linear-gradient(180deg, #0b5f3e, #065f46); }
    .btn.danger { background: linear-gradient(180deg, #7f1d1d, #991b1b); }
    .tabs { display: flex; gap: 8px; padding: 14px; border-bottom: 1px solid var(--border); }
    .tab { padding: 10px 14px; border-radius: 10px; cursor: pointer; color: var(--muted); border: 1px solid transparent; }
    .tab.active { color: var(--text); border-color: var(--border); background: rgba(255,255,255,0.03); }
    .tab.disabled { opacity: .35; pointer-events: none; }
  .panel { padding: 16px; overflow-x: auto; }
   /* Make table allow horizontal scroll when content is wider than panel.
     Force real table layout (override global .grid { display:grid } in site CSS). */
   .grid { display: table; width: max-content; min-width: 100%; border-collapse: collapse; table-layout: fixed; }
   .grid thead { display: table-header-group; }
   .grid tbody { display: table-row-group; }
   .grid tr { display: table-row; }
  .grid th, .grid td { border-bottom: 1px solid var(--border); padding: 10px 8px; font-size: 14px; white-space: nowrap; }
    .grid th { text-align: left; color: var(--muted); }
  .row-actions { display: flex; gap: 8px; flex-wrap: wrap; }
    .muted { color: var(--muted); font-size: 12px; }
    .status { font-size: 12px; color: var(--muted); }
    .good { color: var(--accent-2); }
    .bad { color: var(--danger); }
    .section { border-top: 1px dashed var(--border); padding-top: 12px; margin-top: 12px; }
  /* Small button variant (approx 50%) */
  .btn.sm { padding: 6px 10px; font-size: 12px; border-radius: 8px; min-width: 80px; min-height: 30px; }
  /* Horizontal scroll helpers */
  .table-scroll-x { overflow-x: auto; overflow-y: hidden; }
  .table-scroll-spacer { height: 1px; }
  /* Truncate long summary text */
  .summary-cell { max-width: 520px; overflow: hidden; text-overflow: ellipsis; }
  </style>
</head>
<body>
  <div class="container">
    <div class="card">
      <div class="header">
        <div>
          <div class="title">Admin Dashboard</div>
          <div class="subtitle">Users · Figures · RAG Sources</div>
        </div>
        <div class="controls">
          <div id="authStatus" class="pill bad">Signed out</div>
          <div id="adminStatus" class="pill">Admin inactive</div>
          <button class="btn" id="lockAdminBtn">Lock Admin</button>
          <button class="btn danger" id="logoutBtn">Logout</button>
        </div>
      </div>

      <div class="tabs">
  <div class="tab active" data-tab="users">Users</div>
  <div class="tab" data-tab="figures">Figures</div>
  <div class="tab" data-tab="rag">RAG Sources</div>
  <div class="tab" data-tab="llm">LLM Settings</div>
      </div>

      <!-- USERS -->
      <div class="panel" id="panel-users">
        <button class="btn" id="refreshUsers">Refresh</button>
        <span class="status" id="usersStatus">Waiting…</span>
        <!-- top scrollbar -->
        <div class="table-scroll-x" id="usersScrollTop"><div class="table-scroll-spacer" id="usersScrollTopInner"></div></div>
        <table class="grid" id="usersTable">
          <colgroup>
            <col style="width:60px" />
            <col style="width:340px" />
            <col style="width:120px" />
            <col style="width:360px" />
          </colgroup>
          <thead><tr><th>ID</th><th>Email</th><th>Role</th><th>Actions</th></tr></thead>
          <tbody id="usersBody"></tbody>
        </table>
        <!-- bottom scrollbar retains via .panel overflow-x -->
      </div>

      <!-- FIGURES -->
      <div class="panel" id="panel-figures" style="display:none;">
        <button class="btn" id="refreshFigures">Refresh</button>
        <span class="status" id="figuresStatus">Waiting…</span>
        <div class="section" style="margin-top:10px;">
          <h4 style="margin:6px 0 8px;">Add / Update Figure</h4>
          <div class="row" style="flex-wrap:wrap; gap:8px;">
            <input id="figName" type="text" placeholder="Name" />
            <input id="figSlug" type="text" placeholder="Slug" />
            <input id="figEra" type="text" placeholder="Era" />
            <input id="figImage" type="text" placeholder="Image URL" style="min-width:260px;" />
          </div>
          <div class="row" style="flex-wrap:wrap; gap:8px; margin-top:8px;">
            <input id="figQuote" type="text" placeholder="Quote (optional)" style="min-width:320px;" />
          </div>
          <div class="row" style="margin-top:8px; gap:8px;">
            <input id="figShort" type="text" placeholder="Short summary" style="flex:1 1 420px; min-width:420px;" />
          </div>
          <div class="row" style="margin-top:8px; gap:8px;">
            <input id="figLong" type="text" placeholder="Long bio (optional)" style="flex:1 1 520px; min-width:520px;" />
          </div>
          <div class="row" style="margin-top:10px; gap:8px;">
            <button class="btn sm success" id="createFigureBtn">Create Figure</button>
            <button class="btn sm" id="updateFigureBtn">Update Figure</button>
          </div>
        </div>
        <!-- top scrollbar -->
        <div class="table-scroll-x" id="figuresScrollTop"><div class="table-scroll-spacer" id="figuresScrollTopInner"></div></div>
        <table class="grid" id="figuresTable">
          <colgroup>
            <col style="width:60px" />
            <col style="width:240px" />
            <col style="width:180px" />
            <col style="width:140px" />
            <col style="width:520px" />
            <col style="width:240px" />
          </colgroup>
          <thead><tr><th>ID</th><th>Name</th><th>Slug</th><th>Era</th><th>Summary</th><th>Actions</th></tr></thead>
          <tbody id="figuresBody"></tbody>
        </table>
      </div>

      <!-- RAG SOURCES -->
      <div class="panel" id="panel-rag" style="display:none;">
        <button class="btn" id="refreshRag">Refresh</button>
        <span class="status" id="ragStatus">Waiting…</span>
        <!-- top scrollbar -->
        <div class="table-scroll-x" id="ragScrollTop"><div class="table-scroll-spacer" id="ragScrollTopInner"></div></div>
        <table class="grid" id="ragTable">
          <colgroup>
            <col style="width:220px" />
            <col style="width:260px" />
            <col style="width:200px" />
            <col style="width:120px" />
            <col style="width:280px" />
          </colgroup>
          <thead>
            <tr>
              <th>Slug</th>
              <th>Name</th>
              <th>Contexts</th>
              <th>Embeddings</th>
              <th>Source Links</th>
            </tr>
          </thead>
          <tbody id="ragBody"></tbody>
        </table>
      </div>

      <!-- LLM SETTINGS -->
      <div class="panel" id="panel-llm" style="display:none;">
        <div class="section">
          <h4>Profiles</h4>
          <select id="llm-profile-select"></select>
          <button class="btn success" id="llm-profile-activate">Activate</button>
        </div>
        <div class="section">
          <h4>Create / Update Profile</h4>
          <input id="llm-profile-name" type="text" placeholder="Profile name (e.g., prod-openai-mini)" />
          <input id="llm-provider" type="text" placeholder="provider (openai | openrouter)" />
          <input id="llm-model" type="text" placeholder="model (e.g., gpt-4o-mini)" />
          <input id="llm-api-base" type="text" placeholder="api_base (optional)" />
          <input id="llm-temp" type="number" step="0.1" placeholder="temperature (0–1)" />
          <input id="llm-topp" type="number" step="0.1" placeholder="top_p (0–1)" />
          <input id="llm-max" type="number" placeholder="max_tokens" />
          <button class="btn" id="llm-profile-save">Save Profile</button>
        </div>
        <div class="section">
          <h4>Advanced (Direct Edit)</h4>
          <div class="muted">Applies to runtime only. Use “Save Profile” to persist settings.</div>
          <input id="llm-provider-direct" type="text" placeholder="provider (openai | openrouter)" />
          <input id="llm-model-direct" type="text" placeholder="model (e.g., gpt-4o-mini)" />
          <input id="llm-api-base-direct" type="text" placeholder="api_base (optional)" />
          <input id="llm-temp-direct" type="number" step="0.1" placeholder="temperature (0–1)" />
          <input id="llm-topp-direct" type="number" step="0.1" placeholder="top_p (0–1)" />
          <input id="llm-max-direct" type="number" placeholder="max_tokens" />
          <button class="btn primary" id="llm-direct-save">Apply Runtime</button>
        </div>
        <div class="section">
          <h4>Health</h4>
          <pre id="llm-health" class="muted">Waiting…</pre>
        </div>
      </div>

      <div class="footer-note">Tokens are in-memory only. Reload drops them.</div>
    </div>
  </div>

  <script src="/static/admin.js?v=admin-login"></script>
</body>
</html>
